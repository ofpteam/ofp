<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.webside.ofp.mapper.QuotationSheetMapper">
	<resultMap id="quotationSheetMap" type="com.webside.ofp.model.QuotationSheetEntity">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Jul 20 
			23:16:43 CST 2017. -->
		<id column="QUOTATION_SHEET_ID" jdbcType="INTEGER" property="quotationSheetId" />
		<result column="INTEREST_RATE_ID" jdbcType="INTEGER" property="interestRateId" />
		<result column="QUOTATION_SHEET_CODE" jdbcType="VARCHAR"
			property="quotationSheetCode" />
		<result column="QUOTATION_DATE" jdbcType="DATE" property="quotationDate" />
		<result column="PRICE_TERMS" jdbcType="VARCHAR" property="priceTerms" />
		<result column="CURRENCY" jdbcType="VARCHAR" property="currency" />
		<result column="EXCHANGE_RATE" jdbcType="DECIMAL" property="exchangeRate" />
		<result column="EXPIRATION_DATE" jdbcType="TIMESTAMP" property="expirationDate" />
		<result column="PAY_MODE" jdbcType="VARCHAR" property="payMode" />
		<result column="RESOURCE" jdbcType="VARCHAR" property="resource" />
		<result column="DEST" jdbcType="VARCHAR" property="dest" />
		<result column="DELIVERY_DATE" jdbcType="TIMESTAMP" property="deliveryDate" />
		<result column="INSURANCE_COST" jdbcType="DECIMAL" property="insuranceCost" />
		<result column="FOREIGN_GREIGHT" jdbcType="DECIMAL" property="foreignGreight" />
		<result column="HOME_GREIGHT" jdbcType="DECIMAL" property="homeGreight" />
		<result column="OPERATION_COST" jdbcType="DECIMAL" property="operationCost" />
		<result column="COMMISSION" jdbcType="DECIMAL" property="commission" />
		<result column="REBATE" jdbcType="DECIMAL" property="rebate" />
		<result column="TOTAL_CBM" jdbcType="DECIMAL" property="totalCbm" />
		<result column="PROFIT" jdbcType="DECIMAL" property="profit" />
		<result column="SWAP_RATE" jdbcType="DECIMAL" property="swapRate" />
		<result column="INTEREST_MONTH" jdbcType="INTEGER" property="interestMonth" />
		<result column="IS_DELETE" jdbcType="INTEGER" property="isDelete" />
		<result column="CREATE_TIME" jdbcType="TIMESTAMP" property="createTime" />
		<result column="MODIFY_TIME" jdbcType="TIMESTAMP" property="modifyTime" />
		<result column="CREATE_USER" jdbcType="INTEGER" property="createUser" />
		<result column="MODIFY_USER" jdbcType="INTEGER" property="modifyUser" />
		<result column="DESCRIPTION" jdbcType="VARCHAR" property="description" />
		<result column="TAX_REBATE_RATE" jdbcType="DECIMAL" property="taxRebateRate" />
		<result column="VALUE_ADDED_TAX_RATE" jdbcType="DECIMAL"
			property="valueAddedTaxRate" />
		<association property="customer" column="CUSTOMER_ID"
			javaType="com.webside.ofp.model.CustomerEntity">
			<id column="CUSTOMER_ID" jdbcType="INTEGER" property="customerId" />
			<result column="CUSTOMER_NAME" jdbcType="VARCHAR" property="customerName" />
			<result column="TELEPHONE" jdbcType="VARCHAR" property="telephone" />
			<result column="COUNTRY" jdbcType="VARCHAR" property="country" />
			<result column="CONTACTS" jdbcType="VARCHAR" property="contacts" />
			<!-- <result column="IS_DELETE" jdbcType="INTEGER" property="isDelete" 
				/> <result column="CREATE_TIME" jdbcType="TIMESTAMP" property="createTime" 
				/> <result column="MODIFY_TIME" jdbcType="TIMESTAMP" property="modifyTime" 
				/> <result column="CREATE_USER" jdbcType="INTEGER" property="createUser" 
				/> <result column="MDOIFY_USER" jdbcType="INTEGER" property="mdoifyUser" 
				/> <result column="DESCRIPTION" jdbcType="VARCHAR" property="description" 
				/> -->
		</association>
		<collection property="subSheetList" column="quotationSubSheetId"
			ofType="com.webside.ofp.model.QuotationSubSheetEntity">
			<id column="QUOTATION_SUB_SHEET_ID" jdbcType="INTEGER" property="quotationSubSheetId" />
			<result column="PRODUCT_ID" jdbcType="INTEGER" property="productId" />
			<!-- <result column="QUOTATION_SHEET_ID" jdbcType="INTEGER" property="quotationSheetId" 
				/> -->
			<result column="USD_PRICE" jdbcType="DECIMAL" property="usdPrice" />
			<result column="BUY_PRICE" jdbcType="DECIMAL" property="buyPrice" />
			<result column="UNIT" jdbcType="VARCHAR" property="unit" />
			<result column="WEIGHT" jdbcType="INTEGER" property="weight" />
			<result column="VOLUME" jdbcType="INTEGER" property="volume" />
			<result column="TOP" jdbcType="DECIMAL" property="top" />
			<result column="BOTTOM" jdbcType="DECIMAL" property="bottom" />
			<result column="HEIGHT" jdbcType="DECIMAL" property="height" />
			<result column="PACKING" jdbcType="VARCHAR" property="packing" />
			<result column="PACKING_RATE" jdbcType="DECIMAL" property="packingRate" />
			<result column="NUMBER" jdbcType="INTEGER" property="number" />
			<result column="PACK_NUM" jdbcType="INTEGER" property="packNum" />
			<result column="TOTALCBM" jdbcType="DECIMAL" property="totalcbm" />
			<result column="GW" jdbcType="DECIMAL" property="gw" />
			<result column="TOTAL_GW" jdbcType="DECIMAL" property="totalGw" />
		</collection>
	</resultMap>

	<sql id="quotation_sheet_column_list">
		qs.QUOTATION_SHEET_ID, qs.INTEREST_RATE_ID,
		qs.QUOTATION_SHEET_CODE, qs.QUOTATION_DATE,
		qs.PRICE_TERMS,
		qs.CURRENCY, qs.EXCHANGE_RATE, qs.EXPIRATION_DATE,
		qs.PAY_MODE,
		qs.RESOURCE, DEST,
		qs.DELIVERY_DATE, qs.INSURANCE_COST,
		qs.FOREIGN_GREIGHT, qs.HOME_GREIGHT,
		qs.OPERATION_COST, qs.COMMISSION,
		qs.REBATE, qs.TOTAL_CBM, qs.PROFIT, qs.SWAP_RATE, qs.INTEREST_MONTH,
		qs.IS_DELETE, qs.CREATE_TIME, qs.MODIFY_TIME,
		qs.CREATE_USER,
		qs.MODIFY_USER,
		qs.DESCRIPTION,qs.TAX_REBATE_RATE,qs.VALUE_ADDED_TAX_RATE
	</sql>

	<sql id="quotation_sub_sheet_column_list">
		qss.QUOTATION_SUB_SHEET_ID, qss.PRODUCT_ID, <!-- qss.QUOTATION_SHEET_ID, -->
		qss.USD_PRICE, qss.BUY_PRICE, qss.UNIT,
		qss.WEIGHT, qss.VOLUME,
		qss.TOP, qss.BOTTOM, qss.HEIGHT, qss.PACKING,
		qss.PACKING_RATE,
		qss.NUMBER, qss.PACK_NUM, qss.TOTALCBM,
		qss.GW, qss.TOTAL_GW
	</sql>

	<sql id="customer_column_List">
		c.CUSTOMER_ID, c.CUSTOMER_NAME, c.TELEPHONE, c.COUNTRY,c.CONTACTS <!-- c.IS_DELETE, 
			c.CREATE_TIME, c.MODIFY_TIME,c.CREATE_USER, c.MODIFY_USER, c.DESCRIPTION -->
	</sql>

	<sql id="where_clause">
		<if test="quotationSheetId != null and quotationSheetId != 0">
			and qs.QUOTATION_SHEET_ID = #{quotationSheetId}
		</if>
		<if
			test="customer != null and customer.customerId != null and customer.customerId != ''">
			and qs.CUSTOMER_ID = #{customerId}
		</if>
		<if test="customername != null and customername != ''">
			and c.CUSTOMER_NAME like
			CONCAT(#{customername},'%')
		</if>
		<if test="quotationSheetCode != null and quotationSheetCode != ''">
			and qs.QUOTATION_SHEET_CODE like
			CONCAT(#{quotationSheetCode},'%')
		</if>
		<if test="endtime != null and endtime != '' ">
		   <![CDATA[ and qs.QUOTATION_DATE <= #{endtime}  ]]>
		</if>
		<if test="starttime != null and starttime != '' ">
			  <![CDATA[ and qs.QUOTATION_DATE >= #{starttime}  ]]>
		</if>

	</sql>

	<select id="queryListByPage" parameterType="map" resultMap="quotationSheetMap"
		flushCache="true" useCache="true">
		SELECT
		<include refid="quotation_sheet_column_list" />
		,
		<include refid="quotation_sub_sheet_column_list" />
		,
		<include refid="customer_column_List" />
		from quotation_sheet qs left join customer c on qs.customer_id =
		c.customer_id
		left join quotation_sub_sheet qss on
		qss.QUOTATION_SHEET_ID =
		qs.QUOTATION_SHEET_ID
		where qs.is_delete = 0
		<include refid="where_clause" />
		<!-- and qs.QUOTATION_SHEET_ID >= ( select QUOTATION_SHEET_ID from quotation_sheet 
			order by QUOTATION_SHEET_ID limit ${start},1 ) limit ${pageNumber} -->
	</select>

	<select id="queryListAll" parameterType="map" resultMap="quotationSheetMap"
		flushCache="true" useCache="true">
		SELECT
		<include refid="quotation_sheet_column_list" />
		,
		<include refid="quotation_sub_sheet_column_list" />
		,
		<include refid="customer_column_List" />
		from quotation_sheet qs left join customer c on qs.customer_id =
		c.customer_id
		left join quotation_sub_sheet qss on
		qss.QUOTATION_SHEET_ID =
		qs.QUOTATION_SHEET_ID
		where qs.is_delete = 0
		<include refid="where_clause" />
		order by QUOTATION_SHEET_ID desc
	</select>

	<select id="findById" parameterType="long" resultMap="quotationSheetMap"
		flushCache="true" useCache="true">
		select
		<include refid="quotation_sheet_column_list" />
		,
		<include refid="quotation_sub_sheet_column_list" />
		,
		<include refid="customer_column_List" />
		from quotation_sheet qs left join customer c on qs.customer_id =
		c.customer_id
		left join quotation_sub_sheet qss on
		qss.QUOTATION_SHEET_ID =
		qs.QUOTATION_SHEET_ID
		where qs.is_delete = 0
		and qs.QUOTATION_SHEET_ID = #{id}
	</select>

	<select id="findByCustomerId" parameterType="long" resultMap="quotationSheetMap"
		flushCache="true" useCache="true">
		select
		<include refid="quotation_sheet_column_list" />
		,
		<include refid="quotation_sub_sheet_column_list" />
		,
		<include refid="customer_column_List" />
		from quotation_sheet qs left join customer c on qs.customer_id =
		c.customer_id
		left join quotation_sub_sheet qss on
		qss.QUOTATION_SHEET_ID =
		qs.QUOTATION_SHEET_ID
		where qs.is_delete = 0
		and qs.customer_id = #{id}
	</select>

	<delete id="deleteById" parameterType="int">
		update quotation_sheet set
		IS_DELETE = 1 where QUOTATION_SHEET_ID = ${id}
	</delete>

	<delete id="deleteBatchById" parameterType="list">
		update quotation_sheet set IS_DELETE = 1 where QUOTATION_SHEET_ID in
		<foreach collection="list" item="id" open="(" separator=","
			close=")">
			#{id}
		</foreach>
	</delete>

	<insert id="insert" parameterType="com.webside.ofp.model.QuotationSheetEntity"
		useGeneratedKeys="true" keyProperty="quotationSheetId">
		insert into quotation_sheet
		(CUSTOMER_ID, INTEREST_RATE_ID,
		QUOTATION_SHEET_CODE, QUOTATION_DATE,
		PRICE_TERMS,
		CURRENCY, EXCHANGE_RATE, EXPIRATION_DATE,
		PAY_MODE,
		RESOURCE, DEST,
		DELIVERY_DATE, INSURANCE_COST, FOREIGN_GREIGHT,
		HOME_GREIGHT, OPERATION_COST, COMMISSION,
		REBATE, TOTAL_CBM, PROFIT,
		SWAP_RATE, INTEREST_MONTH, IS_DELETE,
		CREATE_TIME, CREATE_USER,
		DESCRIPTION,TAX_REBATE_RATE,VALUE_ADDED_TAX_RATE)
		values
		(#{customer.customerId,jdbcType=INTEGER},
		#{interestRateId,jdbcType=INTEGER},
		#{quotationSheetCode,jdbcType=VARCHAR},
		#{quotationDate,jdbcType=DATE}, #{priceTerms,jdbcType=VARCHAR},
		#{currency,jdbcType=VARCHAR}, #{exchangeRate,jdbcType=DECIMAL},
		#{expirationDate,jdbcType=TIMESTAMP},
		#{payMode,jdbcType=VARCHAR},
		#{resource,jdbcType=VARCHAR}, #{dest,jdbcType=VARCHAR},
		#{deliveryDate,jdbcType=TIMESTAMP}, #{insuranceCost,jdbcType=DECIMAL},
		#{foreignGreight,jdbcType=DECIMAL},
		#{homeGreight,jdbcType=DECIMAL},
		#{operationCost,jdbcType=DECIMAL}, #{commission,jdbcType=DECIMAL},
		#{rebate,jdbcType=DECIMAL}, #{totalCbm,jdbcType=DECIMAL},
		#{profit,jdbcType=DECIMAL},
		#{swapRate,jdbcType=DECIMAL},
		#{interestMonth,jdbcType=INTEGER}, 0,
		now(),
		#{createUser,jdbcType=INTEGER}, #{description,jdbcType=VARCHAR}
		,#{taxRebateRate,jdbcType=DECIMAL},
		#{valueAddedTaxRate,jdbcType=DECIMAL})
	</insert>

	<update id="update" parameterType="com.webside.ofp.model.QuotationSheetEntity">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Jul 20 
			23:16:43 CST 2017. -->
		update quotation_sheet
		set CUSTOMER_ID =
		#{customer.customerId,jdbcType=INTEGER},
		INTEREST_RATE_ID =
		#{interestRateId,jdbcType=INTEGER},
		QUOTATION_SHEET_CODE =
		#{quotationSheetCode,jdbcType=VARCHAR},
		QUOTATION_DATE =
		#{quotationDate,jdbcType=DATE},
		PRICE_TERMS =
		#{priceTerms,jdbcType=VARCHAR},
		CURRENCY =
		#{currency,jdbcType=VARCHAR},
		EXCHANGE_RATE =
		#{exchangeRate,jdbcType=DECIMAL},
		EXPIRATION_DATE =
		#{expirationDate,jdbcType=TIMESTAMP},
		PAY_MODE =
		#{payMode,jdbcType=VARCHAR},
		RESOURCE = #{resource,jdbcType=VARCHAR},
		DEST = #{dest,jdbcType=VARCHAR},
		DELIVERY_DATE =
		#{deliveryDate,jdbcType=TIMESTAMP},
		INSURANCE_COST =
		#{insuranceCost,jdbcType=DECIMAL},
		FOREIGN_GREIGHT =
		#{foreignGreight,jdbcType=DECIMAL},
		HOME_GREIGHT =
		#{homeGreight,jdbcType=DECIMAL},
		OPERATION_COST =
		#{operationCost,jdbcType=DECIMAL},
		COMMISSION =
		#{commission,jdbcType=DECIMAL},
		REBATE = #{rebate,jdbcType=DECIMAL},
		TOTAL_CBM = #{totalCbm,jdbcType=DECIMAL},
		PROFIT =
		#{profit,jdbcType=DECIMAL},
		SWAP_RATE = #{swapRate,jdbcType=DECIMAL},
		INTEREST_MONTH = #{interestMonth,jdbcType=INTEGER},
		MODIFY_TIME =
		now(),
		MODIFY_USER = #{modifyUser,jdbcType=INTEGER},
		DESCRIPTION =
		#{description,jdbcType=VARCHAR},
		TAX_REBATE_RATE =
		#{taxRebateRate,jdbcType=DECIMAL},
		VALUE_ADDED_TAX_RATE =
		#{valueAddedTaxRate,jdbcType=DECIMAL}
		where QUOTATION_SHEET_ID =
		#{quotationSheetId,jdbcType=INTEGER}
	</update>

	<select id="selectByPage" parameterType="java.util.Map"
		resultType="java.util.Map">
		SELECT
		<include refid="quotation_sheet_column_list" />
		,
		<include refid="customer_column_List" />
		from quotation_sheet qs left join customer c on qs.customer_id =
		c.customer_id
		where qs.is_delete = 0
		<include refid="where_clause" />
		order by qs.QUOTATION_SHEET_ID desc
	</select>
</mapper>